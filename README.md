# spring-gift-enhancement

## step0 구현 기능

- 3주차 코드 클론
- 비밀번호 암호화
  - spring security BCryptPasswordEncoder로 암호화
  - data.sql로 유저를 생성하면 db에 암호화가 안된채로 저장됨으로 UserCreator추가
    - UserCreator는 @PostConstruct를 사용한다.
    - 의존성 주입이 이루어진 후 초기화를 수행하는 메서드이다
  - 로그인시 email로 유저를 조회하고 조회된 비밀번호화 입력된 비밀번호를 대조해서 인증한다.
  - 유저 생성과 비밀번호 수정시 유저를 검증하고 비밀번호를 암호화 해서 저장한다.

## step1 구현 기능
  
- 상품에 카테고리를 추가한다.
- 카테고리 crud 구현
  - 카테고리명은 중복될 수 없다.
  - 상품이 존재하지 않는 카테고리만 삭제가 가능하다.
- 상품 생성및 수정시 카테고리 id가 필수적으로 수정됨.
- 상품은 한개의 카테고리만 가진다.
- 카테고리는 카테고리명과 상품 리스트를 가진다.
- 카테고리와 상품은 1:n을 가진다.
- 상품 리스트와 특정 상품을 조회하는 기능의 경우 ProductDetail 형태로 반환하게 수정한다.
  - 상품id
  - 상품명
  - 가격
  - 이미지url
  - 생성일
  - 수정일
  - 위시리스트에 담은 유저id리스트
  - 카테고리id

## step2 구현 기능

- 상품 옵션 구현
  - 상품은 1개 이상의 옵션을 갖는다
    - 옵션이 1개 남았을떄 삭제시 반려
  - 옵션은 이름, 재고, 생성일, 수정일을 갖는다.
    - 이름은 영어, 숫자, 한글, ( ), [ ], +, -, &, /, _만 가능하다.
    - 재고는 최소 1개 이상 최대 1억개 까지 가능하다.
    - 이름은 중복될 수 없다.
  - 상품 생성시 옵션에 대한 사항이 필요하다.
  - 상품 수정에서 옵션에 대한 사항을 변결항 수 없다.
  - 상품 삭제시 옵션은 함께 삭제된다.
  - 모든 기본 데이터를 data.sql에서 서비스 로직을 통과하게 수정
    - InitData에 @PostConstruct로 수행

## step3 구현 기능

- product 옵션 증감(상품 주문)
  - 상품의 옵션의 수량을 지정된 숫자만큼 뺴는 기능
  - 동시성 제어가 필요함
    - 재고가 1개 남았는데 동시에 1개를 제거하는 오더가 들어온 경우
    - @Transactional(isolation = Isolation.REPEATABLE_READ)로 동시성 제어
      - Dirty Reads(아직 커밋되지 않은 데이터 일기 방지), 
      - Non-repeatable Reads(다른 트랜잭션에 의해 데이터가 변경되어 다른 값을 일게 되는것 방지)
      - 두 문제를 방지할 수 있어서 선택했다.
  - 상품의 옵션명이 수정될 때 수정될 이름과 현재 이름이 같아다면 허용
    - 재고만 변경되게 하는 경우를 고려함
  - 카테고리 테스트 코드 작성
  - 상품 옵셩 테스트 코드 작성
  - 상품 주문 테스트 코드 작성